(this.webpackJsonpvideochat=this.webpackJsonpvideochat||[]).push([[0],{50:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),i=n(37),o=n.n(i),u=(n(50),n(43)),a=n(1),s=n(31),f=n(38),l=n(45),d=n(21),O=n(23),p=n.n(O),j=n(39),b=n.n(j),h=function(e){var t=Object(r.useState)(e),n=Object(d.a)(t,2),c=n[0],i=n[1],o=Object(r.useRef)(null),u=Object(r.useCallback)((function(e,t){o.current=t,i((function(t){return"function"===typeof e?e(t):e}))}),[]);return Object(r.useEffect)((function(){o.current&&(o.current(c),o.current=null)}),[c]),[c,u]},E=n(44),v=Object(E.a)("http://localhost:3001",{"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]}),I=n(9),D=n.n(I),m="LOCAL_VIDEO";var R=n(2);function x(){var e=function(e){var t=h([]),n=Object(d.a)(t,2),c=n[0],i=n[1],o=Object(r.useCallback)((function(e,t){i((function(t){return t.includes(e)?t:[].concat(Object(l.a)(t),[e])}),t)}),[c,i]),u=Object(r.useRef)({}),a=Object(r.useRef)(null),O=Object(r.useRef)(Object(f.a)({},m,null));return Object(r.useEffect)((function(){function e(){return(e=Object(s.a)(p.a.mark((function e(t){var n,r,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerID,r=t.createOffer,!(n in u.current)){e.next=3;break}return e.abrupt("return",console.warn("Already connected to peer ".concat(n)));case 3:if(u.current[n]=new RTCPeerConnection({iceServers:b()()}),u.current[n].onicecandidate=function(e){e.candidate&&v.emit(D.a.RELAY_ICE,{peerID:n,iceCandidate:e.candidate})},c=0,u.current[n].ontrack=function(e){var t=Object(d.a)(e.streams,1)[0];2===++c&&(c=0,o(n,(function(){if(O.current[n])O.current[n].srcObject=t;else var e=!1,r=setInterval((function(){O.current[n]&&(O.current[n].srcObject=t,e=!0),e&&clearInterval(r)}),1e3)})))},a.current.getTracks().forEach((function(e){u.current[n].addTrack(e,a.current)})),!r){e.next=15;break}return e.next=11,u.current[n].createOffer();case 11:return i=e.sent,e.next=14,u.current[n].setLocalDescription(i);case 14:v.emit(D.a.RELAY_SDP,{peerID:n,sessionDescription:i});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return v.on(D.a.ADD_PEER,(function(t){return e.apply(this,arguments)})),function(){v.off(D.a.ADD_PEER)}}),[]),Object(r.useEffect)((function(){function e(){return(e=Object(s.a)(p.a.mark((function e(t){var n,r,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.peerID,c=t.sessionDescription,e.next=3,null===(n=u.current[r])||void 0===n?void 0:n.setRemoteDescription(new RTCSessionDescription(c));case 3:if("offer"!==c.type){e.next=10;break}return e.next=6,u.current[r].createAnswer();case 6:return i=e.sent,e.next=9,u.current[r].setLocalDescription(i);case 9:v.emit(D.a.RELAY_SDP,{peerID:r,sessionDescription:i});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return v.on(D.a.SESSION_DESCRIPTION,(function(t){return e.apply(this,arguments)})),function(){v.off(D.a.SESSION_DESCRIPTION)}}),[]),Object(r.useEffect)((function(){return v.on(D.a.ICE_CANDIDATE,(function(e){var t,n=e.peerID,r=e.iceCandidate;null===(t=u.current[n])||void 0===t||t.addIceCandidate(new RTCIceCandidate(r))})),function(){v.off(D.a.ICE_CANDIDATE)}}),[]),Object(r.useEffect)((function(){return v.on(D.a.REMOVE_PEER,(function(e){var t=e.peerID;u.current[t]&&u.current[t].close(),delete u.current[t],delete O.current[t],i((function(e){return e.filter((function(e){return e!==t}))}))})),function(){v.off(D.a.REMOVE_PEER)}}),[]),Object(r.useEffect)((function(){function t(){return(t=Object(s.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:1280,height:720}});case 2:a.current=e.sent,o(m,(function(){var e=O.current.LOCAL_VIDEO;e&&(e.volume=0,e.srcObject=a.current)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){return t.apply(this,arguments)}().then((function(){return v.emit(D.a.JOIN,{room:e})})).catch((function(e){return console.error("Error getting userMedia:",e)})),function(){a.current.getTracks().forEach((function(e){return e.stop()})),v.emit(D.a.LEAVE)}}),[e]),{clients:c,provideMediaRef:Object(r.useCallback)((function(e,t){O.current[e]=t}),[])}}(Object(a.g)().id),t=e.clients,n=e.provideMediaRef,c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=Array.from({length:e}).reduce((function(e,t,n,r){return n%2===0&&e.push(r.slice(n,n+2)),e}),[]),n=t.length,r="".concat(100/n,"%");return t.map((function(e,t,n){return t===n.length-1&&1===e.length?[{width:"100%",height:r}]:e.map((function(){return{width:"50%",height:r}}))})).flat()}(t.length);return Object(R.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",height:"100vh"},children:t.map((function(e,t){return Object(R.jsx)("div",{style:c[t],id:e,children:Object(R.jsx)("video",{width:"100%",height:"100%",ref:function(t){n(e,t)},autoPlay:!0,playsInline:!0,muted:e===m})},e)}))})}var C=n(66);function A(){var e=Object(a.f)(),t=Object(r.useState)([]),n=Object(d.a)(t,2),c=n[0],i=n[1],o=Object(r.useRef)();return Object(r.useEffect)((function(){v.on(D.a.SHARE_ROOMS,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.rooms,n=void 0===t?[]:t;o.current&&i(n)}))}),[]),Object(R.jsxs)("div",{ref:o,children:[Object(R.jsx)("h1",{children:"Available Rooms"}),Object(R.jsx)("ul",{children:c.map((function(t){return Object(R.jsxs)("li",{children:[t,Object(R.jsx)("button",{onClick:function(){e.push("/room/".concat(t))},children:"JOIN ROOM"})]},t)}))}),Object(R.jsx)("button",{onClick:function(){e.push("/room/".concat(Object(C.a)()))},children:"Create New Room"})]})}function S(){return Object(R.jsx)("div",{children:"NOT FOUND."})}var g=function(){return Object(R.jsx)(u.a,{children:Object(R.jsxs)(a.c,{children:[Object(R.jsx)(a.a,{exact:!0,path:"/room/:id",component:x}),Object(R.jsx)(a.a,{exact:!0,path:"/",component:A}),Object(R.jsx)(a.a,{component:S})]})})};o.a.render(Object(R.jsx)(c.a.StrictMode,{children:Object(R.jsx)(g,{})}),document.getElementById("root"))},9:function(e,t){e.exports={JOIN:"join",LEAVE:"leave",SHARE_ROOMS:"share-rooms",ADD_PEER:"add-peer",REMOVE_PEER:"remove-peer",RELAY_SDP:"relay-sdp",RELAY_ICE:"relay-ice",ICE_CANDIDATE:"ice-candidate",SESSION_DESCRIPTION:"session-description"}}},[[64,1,2]]]);
//# sourceMappingURL=main.aa7aa454.chunk.js.map